@using MementoMori.Ortega.Share.Data.Character
@using MementoMori.WebUI.UI
@using MementoMori.Ortega.Share
@using MementoMori.Ortega.Share.Enums
@inject AtlasManager AtlasManager

@{
    var sprite = AtlasManager.GetCharacterFrame(UserCharacterInfo.RarityFlags);
    var deco = AtlasManager.GetCharacterFrameDecoration(UserCharacterInfo.RarityFlags);
    var characterMb = Masters.CharacterTable.GetById(UserCharacterInfo.CharacterId);
    var element = AtlasManager.GetIconCharacterElement(characterMb.ElementType);
    var scale = Size / 128.0;
}

<div style="width: 128px; height: 128px; position: relative; transform:scale(@(scale));transform-origin: top left;">
    <div style="
background-image: url(assets/Atlas/plate_character.png);
background-size: contain; 
height: 100%; 
width: 100%;
position: absolute;
z-index: 8;
background-origin: content-box;
background-repeat: no-repeat;
"></div>
    <div style="
background-image: url(@AtlasManager.GetCharacterIcon(UserCharacterInfo.CharacterId)); 
background-size: contain; 
height: 100%; 
width: 100%;
position: absolute;
z-index: 9;
border-width: 6px;
border-color: transparent;
background-origin: content-box;
background-repeat: no-repeat;
"></div>
    <div style="
height: 100%;
width: 100%;
border-image-source: url(@sprite.Url);
border-image-slice: 20;
position: absolute;
z-index: 10;
filter: @(sprite.Filter);
border-image-width: auto;
border-width:5px;
border-image-outset: 6px;
"></div>
    <span style="
position: absolute;
top: 2px;
right: 10px;
font-size: 24px;
z-index: 11;
color: white;
text-shadow: 0px 0px 5px black;
">
        Lv @UserCharacterInfo.Level
    </span>
    @if (!string.IsNullOrEmpty(deco))
    {
    
    <img src="@deco" style="
position: absolute;
bottom: 0;
right: 0;
z-index: 11;
width:32px;
height:32px;
"/>
    }
    @if (!string.IsNullOrEmpty(element))
        {
    
    <img src="@element" style="
position: absolute;
top: 2px;
left: 2px;
z-index: 11;
width:34px;
height:34px;
"/>
    }
    @if (UserCharacterInfo.RarityFlags > CharacterRarityFlags.LR)
    {
        var icon = "assets/Atlas/icon_rarity_plus_star_1.png";
        if (characterMb.RarityFlags >= CharacterRarityFlags.LRPlus6)
        {
            icon = "assets/Atlas/icon_rarity_plus_star_2.png";
        }

        var count = UserCharacterInfo.RarityFlags switch
        {
            CharacterRarityFlags.LRPlus => 1,
            CharacterRarityFlags.LRPlus2 => 2,
            CharacterRarityFlags.LRPlus3 => 3,
            CharacterRarityFlags.LRPlus4 => 4,
            CharacterRarityFlags.LRPlus5 => 5,
            CharacterRarityFlags.LRPlus6 => 1,
            CharacterRarityFlags.LRPlus7 => 2,
            CharacterRarityFlags.LRPlus8 => 3,
            CharacterRarityFlags.LRPlus9 => 4,
            CharacterRarityFlags.LRPlus10 => 5,
            _ => 0
            };

        <div style="
position: absolute;
bottom: -3px;
z-index: 11;
left: 20px;
">
            @for (var i = 0; i < count; i++)
            {
                <img style="display: inline-block; height:20px; width: 20px; margin: 0 -3px 0 0" src="@icon" />
            }
        </div>
    }
</div>

@code {

    [Parameter]
    public UserCharacterInfo UserCharacterInfo { get; set; }

    [Parameter]
    public int Size { get; set;} = 128;
}
